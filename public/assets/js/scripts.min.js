'use strict';

function closeAlert($elem) {
	
	var $container = $('.alert-container');
	
	var delay = $container.length?$container.closest('.alert-container').attr('data-delay'):null;
	
	if (!delay || !$.isNumeric(delay)) {
		delay = 10000;
	}

	setTimeout(function() {
		
		$elem.removeClass('fadeInDown').addClass('fadeOutUp');
		
		setTimeout(function() {
			$elem.remove();
		}, 500);
	
	}, delay);
}

var $alert;

function getAlertContent(type, message) {
	
	var icons = {
		success: 'fa fa-check',
		info: 'fa fa-info',
		error: 'fa fa-times',
		warning: 'fa fa-warning'
	}
	
	var alertClass = {
		success: 'alert-success',
		info: 'alert-info',
		error: 'alert-danger',
		warning: 'alert-warning'
	}
	console.log(type);
	var html = 
	'<div class="alert animated fadeInDown">'+
		'<span class="icon"><i aria-hidden="true"></i></span>'+
		'<span class="message"></span>'+
		'<button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>'+
	'</div>';
		
	var $elem = $(html);
	$elem.addClass(alertClass[type]);
	$elem.find("i").addClass(icons[type]);
	$elem.find(".message").html(message);
	
	return $elem;
}

$.fn.alert = function(type, message) {
	
	var $elem = getAlertContent(type, message);
	
	closeAlert($elem);
	$(this).append($elem);
	
};

(function() {
	
	$('.alert').each(function() {
		closeAlert($(this));

		// on click in button class close 
		$(this).find('.close').on('click', function() {
			$('.alert-container').closest('.alert-container').attr('data-delay', 0);
			closeAlert($(this).closest('.alert'));
			$('.alert-container').closest('.alert-container').attr('data-delay', 10000);
		});

	});
	
	var toggle = function(type, message, controlSpam) {
		
		var $container = $('.alert-container');
		var $activeAlerts = $container.find(".alert");
		
		if (!controlSpam || (controlSpam == true && $activeAlerts.length == 0)) {
			var $elem = getAlertContent(type, message);
			
			closeAlert($elem);
			$container.append($elem);
			$(window).scrollTop(0);
		}
	}
	
	$alert = {
			
		success: function(message, controlSpam) {
			toggle('success', message, controlSpam);
		},
		
		info: function(message, controlSpam) {
			toggle('info', message, controlSpam);
		},
		
		error: function(message, controlSpam) {
			toggle('error', message, controlSpam);
		},
		
		warning: function(message, controlSpam) {
			toggle('warning', message, controlSpam);
		}
	};
	
})();
// Toogle side modal
$('.open-side-nav').on('click', function () {
    $('.side-panel').css('width', '100%').css('transition', '3s');
    $('.wrapper').css('margin-left', '250px');

});

$('.btn-side-close').on('click', function () {
    $('.side-panel').css('width', '0').css('transition', '1s');;
    $('.wrapper').css('margin-left', '0');
});

// Logout
$('.logout').on(`click`, function () {
    
    var $form = $('<form method="POST" action="' + window.Laravel.url + '/logout' + '" hidden><input name="_token" value="' + window.Laravel.csrfToken + '"></form>');
    $('body').append($form);
    $form.submit();
});

// Delete button
var deleteModalOpen = false;
$("body").on('click', '.btn-delete', function (e) {

    e.preventDefault();

    if (!deleteModalOpen) {

        deleteModalOpen = true;
        var id = $(this).attr('data-id');
        var action = $(this).attr('data-url');
        var question = $(this).attr('data-question');

        if (id !== undefined && action !== undefined) {

            question = question !== undefined && question != '' ? question : 'Essa é uma ação <b>irreversível</b>.<br/>Tem certeza que deseja continuar?';

            dialog.prompt(question, function (result) {

                deleteModalOpen = false;
                if (result == true) {
                    var $form = $('<form method="POST" class="d-none" action="' + action + '"><input name="_method" value="DELETE"/><input name="_token" value="' + window.Laravel.csrfToken + '"><input name="id" value="' + id + '"/></form>');
                    $('body').append($form);
                    $form.submit();
                }
            });
        }
    }
});

$(".select2-select-js").select2({

    // multiple: true,
    placeholder: 'Realize a pesquisa',
    language: {
        noResults: function () {
            return "Nenhum resultado foi encontrado"
        }
    }
});
var dialog = {
		
	success : function(message) {
		return bootbox.alert({
			title: "<div class='dl-title dl-success'><div>Sucesso</div></div>",
			message: message
		});
	},
	
	warning : function(message) { 
		return bootbox.alert({
			title: "<div class='dl-title dl-warning'>Atenção!</div>",
			message: message
		});
	}, 
	
	prompt: function(message, callback, title, size) {
		return bootbox.confirm({
			title: title || "<div class='dl-title dl-warning'>Atenção!</div>",
			message: message,
			callback: callback,
			size: size || 'small',
			buttons: {
                confirm: {
                    label: "Ok",
                    className: "btn-primary"
                },
                cancel: {
                    label: "Cancelar",
                    className: "btn-light"
                }
			}
		});
	},
	
	message: function(title, message, buttons) {
		
		return bootbox.dialog({
            title: title,
            message: message,
            buttons: buttons
		});
	},
	
	closeAll: function() {
		bootbox.hideAll();
	}
}
